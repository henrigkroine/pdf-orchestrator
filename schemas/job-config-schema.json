{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "PDF Orchestrator Job Configuration Schema",
  "description": "Complete schema for PDF generation jobs with AI-powered features (Tier 1-3)",
  "type": "object",
  "required": ["name", "template", "data", "output"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Human-readable job name"
    },
    "description": {
      "type": "string",
      "description": "Detailed job description"
    },
    "template": {
      "type": "string",
      "enum": ["partnership", "report", "campaign", "newsletter"],
      "description": "Template type to use"
    },
    "design_system": {
      "type": "string",
      "enum": ["tfu", "teei", "custom"],
      "description": "Design system (TFU = Together for Ukraine, TEEI = Educational Equality Institute)"
    },
    "validate_tfu": {
      "type": "boolean",
      "default": false,
      "description": "Enable TFU brand compliance validation"
    },
    "generator": {
      "type": "object",
      "description": "Document generation settings",
      "properties": {
        "type": {
          "type": "string",
          "description": "Generator type identifier"
        },
        "jsx_script": {
          "type": "string",
          "description": "Path to ExtendScript JSX file for InDesign automation"
        }
      }
    },
    "data": {
      "type": "object",
      "description": "Content data for document population",
      "properties": {
        "title": {
          "type": "string",
          "description": "Document title"
        },
        "subtitle": {
          "type": "string",
          "description": "Document subtitle"
        },
        "organization": {
          "type": "string",
          "description": "Organization name"
        },
        "partner": {
          "type": "string",
          "description": "Partner organization name"
        }
      }
    },
    "typography_sidecar": {
      "type": "string",
      "description": "Path to typography metadata JSON file"
    },
    "expected_metrics": {
      "type": "object",
      "description": "Expected metrics for validation",
      "properties": {
        "core": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Core metrics that must appear in document"
        },
        "outcomes": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Outcome metrics (percentages, currency)"
        },
        "strategic": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Strategic metrics (investment, reach)"
        }
      }
    },
    "output": {
      "type": "object",
      "required": ["filename_base", "export_path"],
      "description": "Output configuration",
      "properties": {
        "formats": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["indd", "pdf_digital", "pdf_print", "html"]
          },
          "description": "Output formats to generate"
        },
        "intent": {
          "type": "string",
          "enum": ["print", "screen", "both"],
          "default": "screen",
          "description": "Output intent (print = 300 DPI CMYK, screen = 150 DPI RGB)"
        },
        "filename_base": {
          "type": "string",
          "description": "Base filename (without extension)"
        },
        "export_path": {
          "type": "string",
          "default": "./exports",
          "description": "Export directory path"
        },
        "pdf_settings": {
          "type": "object",
          "description": "PDF export settings",
          "properties": {
            "digital": {
              "type": "object",
              "properties": {
                "preset": {
                  "type": "string",
                  "default": "[High Quality Print]"
                },
                "color_space": {
                  "type": "string",
                  "enum": ["RGB", "CMYK"],
                  "default": "RGB"
                },
                "resolution": {
                  "type": "number",
                  "minimum": 72,
                  "maximum": 600,
                  "default": 150
                },
                "optimize_web": {
                  "type": "boolean",
                  "default": true
                }
              }
            }
          }
        }
      }
    },
    "quality": {
      "type": "object",
      "description": "Quality thresholds and validation settings",
      "properties": {
        "validation_threshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 150,
          "default": 100,
          "description": "Minimum validation score (0-150 scale)"
        },
        "auto_fix": {
          "type": "boolean",
          "default": false,
          "description": "Enable auto-fix for common issues"
        },
        "strict_mode": {
          "type": "boolean",
          "default": false,
          "description": "Strict validation mode (fail on warnings)"
        },
        "required_checks": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["tfu_compliance", "typography_design", "pdf_structure", "content", "visual_hierarchy", "accessibility"]
          },
          "description": "Required validation checks"
        }
      }
    },
    "mcp_requirements": {
      "type": "object",
      "description": "MCP (Model Context Protocol) settings for InDesign automation",
      "properties": {
        "require_mcp_for_validation": {
          "type": "boolean",
          "default": false
        },
        "proxy_url": {
          "type": "string",
          "format": "uri",
          "default": "http://localhost:8013"
        },
        "timeout": {
          "type": "number",
          "minimum": 5,
          "maximum": 300,
          "default": 30
        }
      }
    },
    "qaProfile": {
      "type": "object",
      "description": "QA profile for automated validation",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique QA profile identifier"
        },
        "min_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 150,
          "default": 100
        },
        "min_tfu_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 150,
          "description": "Minimum TFU brand compliance score"
        },
        "max_visual_diff_percent": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "default": 5.0,
          "description": "Maximum allowed visual difference percentage"
        },
        "visual_baseline_id": {
          "type": "string",
          "description": "Visual baseline reference ID for regression testing"
        },
        "create_baseline_on_first_pass": {
          "type": "boolean",
          "default": false
        }
      }
    },
    "gemini_vision": {
      "type": "object",
      "description": "Google Gemini Vision API settings for visual QA",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false
        },
        "min_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "default": 0.85
        },
        "fail_on_critical": {
          "type": "boolean",
          "default": true
        },
        "output_dir": {
          "type": "string",
          "default": "reports/gemini"
        }
      }
    },
    "planning": {
      "type": "object",
      "description": "Planning phase configuration (Tier 2)",
      "properties": {
        "rag_enabled": {
          "type": "boolean",
          "default": false,
          "description": "DEPRECATED: Use planning.rag.enabled instead"
        },
        "rag": {
          "type": "object",
          "description": "RAG (Retrieval-Augmented Generation) configuration",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable RAG for document planning"
            },
            "vectorDatabase": {
              "type": "string",
              "enum": ["qdrant", "chromadb", "pinecone", "weaviate"],
              "default": "qdrant",
              "description": "Vector database provider"
            },
            "embeddingModel": {
              "type": "string",
              "default": "openai/text-embedding-3-large",
              "description": "Embedding model for semantic search"
            },
            "retrievalCount": {
              "type": "number",
              "minimum": 1,
              "maximum": 20,
              "default": 5,
              "description": "Number of top documents to retrieve"
            },
            "similarityThreshold": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "default": 0.75,
              "description": "Minimum similarity score (0.0 - 1.0)"
            },
            "indexPath": {
              "type": "string",
              "default": "ai/rag/indexes/",
              "description": "Path to vector index storage"
            },
            "fallbackBehavior": {
              "type": "string",
              "enum": ["warn", "error", "disable"],
              "default": "warn",
              "description": "Behavior when RAG fails (warn = log and continue, error = fail job, disable = skip RAG)"
            },
            "hybridSearch": {
              "type": "object",
              "description": "Hybrid search settings (semantic + keyword + performance)",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true
                },
                "keywords": {
                  "type": "array",
                  "items": {"type": "string"},
                  "description": "Keywords for keyword-based boost"
                },
                "minPerformanceScore": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "default": 0.0
                },
                "boostRecent": {
                  "type": "boolean",
                  "default": true,
                  "description": "Boost more recent documents"
                }
              }
            }
          }
        },
        "personalization_enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable partner-specific personalization"
        },
        "partner_profile_id": {
          "type": "string",
          "description": "Partner profile ID for RAG retrieval"
        },
        "performance_recommendations": {
          "type": "boolean",
          "default": false,
          "description": "Enable performance-based content recommendations"
        },
        "partner_profiles_db": {
          "type": "string",
          "default": "data/partner-profiles.json",
          "description": "Path to partner profiles database"
        }
      }
    },
    "generation": {
      "type": "object",
      "description": "Generation phase configuration (Tier 2-3)",
      "properties": {
        "figma": {
          "type": "object",
          "description": "Figma integration settings",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "file_id": {
              "type": "string",
              "description": "Figma file ID"
            },
            "page": {
              "type": "string",
              "description": "Figma page name"
            },
            "component_map": {
              "type": "object",
              "additionalProperties": {"type": "string"},
              "description": "Mapping of Figma components to document sections"
            }
          }
        },
        "imageGeneration": {
          "type": "object",
          "description": "AI image generation configuration (Tier 3)",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable AI image generation"
            },
            "provider": {
              "type": "string",
              "enum": ["openai-dalle3", "stable-diffusion", "replicate", "generic_image_api"],
              "default": "openai-dalle3",
              "description": "Image generation provider"
            },
            "quality": {
              "type": "string",
              "enum": ["standard", "hd"],
              "default": "hd",
              "description": "DALL-E 3 quality setting (standard or hd)"
            },
            "style": {
              "type": "string",
              "enum": ["natural", "vivid"],
              "default": "natural",
              "description": "DALL-E 3 style setting (natural or vivid)"
            },
            "size": {
              "type": "string",
              "enum": ["1024x1024", "1792x1024", "1024x1792"],
              "default": "1792x1024",
              "description": "Image dimensions (landscape recommended for hero images)"
            },
            "cacheEnabled": {
              "type": "boolean",
              "default": true,
              "description": "Cache generated images to avoid regeneration"
            },
            "cachePath": {
              "type": "string",
              "default": "assets/images/generated/",
              "description": "Cache directory for generated images"
            },
            "cacheMaxAgeDays": {
              "type": "number",
              "minimum": 1,
              "maximum": 365,
              "default": 30,
              "description": "Maximum cache age in days"
            },
            "requirements": {
              "type": "object",
              "description": "Image requirements by type",
              "properties": {
                "heroImage": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true
                    },
                    "prompt": {
                      "type": "string",
                      "description": "Hero image generation prompt"
                    },
                    "negativePrompt": {
                      "type": "string",
                      "description": "Negative prompt (what to avoid)"
                    }
                  }
                },
                "programPhotos": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true
                    },
                    "count": {
                      "type": "number",
                      "minimum": 1,
                      "maximum": 10,
                      "default": 3
                    },
                    "promptTemplate": {
                      "type": "string",
                      "description": "Template with {program_name} placeholder"
                    }
                  }
                }
              }
            },
            "prompts": {
              "type": "object",
              "additionalProperties": {"type": "string"},
              "description": "Manual prompts for specific image slots"
            },
            "hero_style": {
              "type": "string",
              "description": "DEPRECATED: Use requirements.heroImage.prompt instead"
            },
            "cache_dir": {
              "type": "string",
              "description": "DEPRECATED: Use cachePath instead"
            }
          }
        },
        "fontPairing": {
          "type": "object",
          "description": "Font pairing settings",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": true
            },
            "strategy": {
              "type": "string",
              "enum": ["constrained", "flexible", "ai_suggested"],
              "default": "constrained"
            },
            "allow_alternatives": {
              "type": "boolean",
              "default": false
            },
            "tfu_brand_lock": {
              "type": "boolean",
              "default": true,
              "description": "Lock to TFU brand fonts (Lora + Roboto)"
            }
          }
        },
        "layoutIteration": {
          "type": "object",
          "description": "Layout iteration settings",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "num_variations": {
              "type": "number",
              "minimum": 2,
              "maximum": 10,
              "default": 5
            },
            "variation_strategies": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": ["hero_image", "card_layout", "split_screen", "grid", "asymmetric"]
              },
              "description": "Layout variation strategies to try"
            },
            "parallel_execution": {
              "type": "boolean",
              "default": true
            }
          }
        }
      }
    },
    "validation": {
      "type": "object",
      "description": "Validation phase configuration (Tier 2-3)",
      "properties": {
        "smoldocling": {
          "type": "object",
          "description": "Small DocLing layout analysis settings",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false
            },
            "model": {
              "type": "string",
              "default": "smolvlm-500m",
              "description": "Layout analysis model"
            },
            "output_dir": {
              "type": "string",
              "default": "reports/layout"
            }
          }
        },
        "accessibility": {
          "type": "object",
          "description": "Accessibility validation and remediation (Tier 3)",
          "properties": {
            "enabled": {
              "type": "boolean",
              "default": false,
              "description": "Enable accessibility validation"
            },
            "standards": {
              "type": "object",
              "description": "Accessibility standards to validate against",
              "properties": {
                "wcag22AA": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true
                    },
                    "failOnViolation": {
                      "type": "boolean",
                      "default": true,
                      "description": "Fail job if WCAG 2.2 AA violations found"
                    }
                  }
                },
                "pdfUA": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true
                    },
                    "failOnViolation": {
                      "type": "boolean",
                      "default": false
                    }
                  }
                },
                "section508": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": false
                    },
                    "failOnViolation": {
                      "type": "boolean",
                      "default": false
                    }
                  }
                }
              }
            },
            "autoRemediation": {
              "type": "object",
              "description": "Automatic accessibility remediation",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable auto-remediation of accessibility issues"
                },
                "altText": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true,
                      "description": "Auto-generate alt text for images"
                    },
                    "aiProvider": {
                      "type": "string",
                      "enum": ["aws-bedrock", "openai-gpt4v", "google-gemini"],
                      "default": "aws-bedrock",
                      "description": "AI provider for alt text generation"
                    },
                    "model": {
                      "type": "string",
                      "default": "anthropic.claude-3-haiku-20240307-v1:0",
                      "description": "Model ID for alt text generation"
                    },
                    "maxLength": {
                      "type": "number",
                      "minimum": 50,
                      "maximum": 200,
                      "default": 125,
                      "description": "Maximum alt text length in characters"
                    }
                  }
                },
                "structureTags": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true,
                      "description": "Auto-tag document structure (headings, paragraphs, lists)"
                    }
                  }
                },
                "readingOrder": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true,
                      "description": "Fix reading order based on layout analysis"
                    }
                  }
                },
                "contrastAdjustment": {
                  "type": "object",
                  "properties": {
                    "enabled": {
                      "type": "boolean",
                      "default": true,
                      "description": "Auto-adjust colors to meet contrast ratios"
                    },
                    "targetRatio": {
                      "type": "number",
                      "minimum": 3.0,
                      "maximum": 7.0,
                      "default": 4.5,
                      "description": "Target contrast ratio (4.5:1 for AA, 7:1 for AAA)"
                    }
                  }
                }
              }
            },
            "reportPath": {
              "type": "string",
              "default": "reports/accessibility/",
              "description": "Path for accessibility reports"
            },
            "target_standard": {
              "type": "string",
              "enum": ["WCAG_2.1_AA", "WCAG_2.2_AA", "PDF_UA"],
              "description": "DEPRECATED: Use standards.wcag22AA.enabled instead"
            },
            "output_dir": {
              "type": "string",
              "description": "DEPRECATED: Use reportPath instead"
            },
            "remediation_provider": {
              "type": "string",
              "description": "DEPRECATED: Use autoRemediation.altText.aiProvider instead"
            }
          }
        }
      }
    },
    "analytics": {
      "type": "object",
      "description": "Analytics and performance tracking",
      "properties": {
        "performance_tracking": {
          "type": "boolean",
          "default": false
        },
        "partner_id": {
          "type": "string",
          "description": "Partner identifier for analytics"
        },
        "doc_family": {
          "type": "string",
          "description": "Document family (e.g., tfu_partnership)"
        },
        "analytics_db": {
          "type": "string",
          "default": "sqlite:///database/performance.db",
          "description": "Analytics database connection string"
        }
      }
    },
    "ai": {
      "type": "object",
      "description": "AI subsystem configuration (Tier 1-1.5)",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable AI-powered validation"
        },
        "dryRun": {
          "type": "boolean",
          "default": true,
          "description": "Dry run mode (scoring only, no pipeline failures)"
        },
        "advancedMode": {
          "type": "boolean",
          "default": false,
          "description": "Advanced mode (Tier 1.5 - real PDF extraction)"
        },
        "features": {
          "type": "object",
          "description": "Feature-specific settings",
          "properties": {
            "typography": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "weight": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "default": 0.4
                },
                "minScore": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "default": 0.85
                }
              }
            },
            "whitespace": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "weight": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "default": 0.3
                },
                "minScore": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "default": 0.80
                }
              }
            },
            "color": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "weight": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "default": 0.3
                },
                "minScore": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "default": 0.90
                }
              }
            },
            "layout": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                },
                "weight": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "default": 0.25
                },
                "minScore": {
                  "type": "number",
                  "minimum": 0.0,
                  "maximum": 1.0,
                  "default": 0.85
                }
              }
            }
          }
        },
        "thresholds": {
          "type": "object",
          "properties": {
            "minNormalizedScore": {
              "type": "number",
              "minimum": 0.0,
              "maximum": 1.0,
              "default": 0.85,
              "description": "Minimum normalized AI score (0.0 - 1.0)"
            },
            "failOnCriticalIssues": {
              "type": "boolean",
              "default": true,
              "description": "Fail pipeline if critical issues detected"
            }
          }
        },
        "output": {
          "type": "object",
          "properties": {
            "reportDir": {
              "type": "string",
              "default": "reports/ai",
              "description": "AI report output directory"
            },
            "includeInLayer1Score": {
              "type": "boolean",
              "default": true,
              "description": "Include AI score in Layer 1 (0-150) total"
            },
            "layer1Points": {
              "type": "number",
              "minimum": 0,
              "maximum": 50,
              "default": 10,
              "description": "Points allocated to AI in Layer 1 (0-150 scale)"
            }
          }
        },
        "future": {
          "type": "object",
          "description": "DEPRECATED: Use planning/generation/validation sections instead",
          "properties": {
            "layout": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                }
              }
            },
            "accessibility": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                }
              }
            },
            "rag": {
              "type": "object",
              "properties": {
                "enabled": {
                  "type": "boolean",
                  "default": false
                }
              }
            }
          }
        }
      }
    },
    "mode": {
      "type": "string",
      "enum": ["draft", "standard", "world_class"],
      "default": "standard",
      "description": "Quality mode (draft = fast preview, standard = production, world_class = maximum quality)"
    },
    "tfu_requirements": {
      "type": "object",
      "description": "Together for Ukraine brand requirements",
      "properties": {
        "page_count": {
          "type": "number",
          "minimum": 1,
          "default": 4
        },
        "primary_color": {
          "type": "string",
          "pattern": "^#[0-9A-Fa-f]{6}$",
          "default": "#00393F",
          "description": "Primary brand color (hex)"
        },
        "forbidden_colors": {
          "type": "array",
          "items": {
            "type": "string",
            "pattern": "^#[0-9A-Fa-f]{6}$"
          },
          "description": "Colors that must not appear"
        },
        "required_fonts": {
          "type": "array",
          "items": {"type": "string"},
          "default": ["Lora", "Roboto"],
          "description": "Required brand fonts"
        },
        "forbidden_fonts": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Fonts that must not be used"
        },
        "paragraph_style_prefix": {
          "type": "string",
          "default": "TFU_",
          "description": "Required prefix for paragraph styles"
        },
        "content_page_number": {
          "type": "number",
          "description": "Page number for main content"
        },
        "required_elements": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Required design elements"
        },
        "typography_requirements": {
          "type": "object",
          "properties": {
            "min_type_sizes": {
              "type": "number",
              "minimum": 1,
              "default": 11,
              "description": "Minimum number of distinct type sizes"
            },
            "hierarchy_levels": {
              "type": "array",
              "items": {"type": "string"},
              "description": "Required typographic hierarchy levels"
            }
          }
        }
      }
    },
    "notes": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Human-readable notes about this configuration"
    }
  }
}
